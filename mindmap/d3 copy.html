<!DOCTYPE html>
<meta charset="utf-8">
<style>
    body {
        width: 100vw;
        height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .node circle {
        fill: #fff;
        stroke: steelblue;
        stroke-width: 3px;
    }

    .node text {
        font-size: 22px;
        font-family: sans-serif;
    }

    .link {
        fill: none;
        stroke: green;
        stroke-width: 2px;
    }
</style>

<body>
    <script src="modules/d3.v5.min.js"></script>
    <script>
        var treeData = {
            "name": "基于身体工学和流行元素的服装定制系统",
            "children": [
                {
                    "name": "开发目的",
                    "children": [
                        { "name": "通过软件功能帮助用户实现个性化服装定制，结合身体工学和流行元素，提升定制体验和满足用户审美需求。" }
                    ]
                },
                {
                    "name": "目标用户",
                    "children": [
                        { "name": "面向时尚定制行业和个人消费者，尤其适合注重穿着感受和个性风格的用户群体。" }
                    ]
                },
                {
                    "name": "主要功能",
                    "children": [
                        { "name": "实现精准测量、智能推荐、虚拟试穿、个性定制等功能，为用户提供全方位的服装定制体验。" }
                    ]
                },
                {
                    "name": "技术特点",
                    "children": [
                        { "name": "采用高科技测量传感器、虚拟现实技术、智能算法和视觉识别技术，实现个性化定制和时尚流行元素的结合。" }
                    ]
                }
            ]
        }


        var margin = { top: 20, right: 240, bottom: 20, left: 240 },
            width = 1400 - margin.left - margin.right,
            height = 600 - margin.top - margin.bottom;

        var svg = d3.select("body").append("svg")
            .attr("width", width + margin.right + margin.left)
            .attr("height", height + margin.top + margin.bottom)
            .append("g")
            .attr("transform", "translate("
                + margin.left + "," + margin.top + ")");

        var i = 0,
            duration = 750,
            root;

        root = d3.hierarchy(treeData, function (d) { return d.children; });
        root.x0 = height / 2;
        root.y0 = 0;

        update(root);

        function diagonal(s, d) {
            return `M ${s.y},${s.x} C ${(s.y + d.y) / 2},${s.x} ${(s.y + d.y) / 2},${d.x} ${d.y},${d.x}`;
        }

        function update(source) {
            var treeLayout = d3.tree().size([width, height]);
            var treeData = treeLayout(root);

            var links = svg.selectAll('path.link')
                .data(treeData.links(), function (d) { return d.target.id; });

            links.enter().append('path')
                .attr('class', 'link')
                .merge(links)
                .transition()
                .duration(duration)
                .attr('d', function (d) { return diagonal(d.source, d.target); });

            links.exit()
                .remove();

            var nodes = svg.selectAll('g.node')
                .data(treeData.descendants(), function (d) { return d.id || (d.id = ++i); });

            var nodeEnter = nodes.enter().append('g')
                .attr('class', 'node')
                .attr("transform", function (d) {
                    return "translate(" + source.y + "," + source.x + ")";
                });

            nodeEnter.append('circle')
                .attr('r', 1e-6);

            nodeEnter.append('text')
                .attr("dy", ".35em")
                .attr("x", function (d) {
                    return d.children || d._children ? -10 : 10;
                })
                .attr("text-anchor", function (d) {
                    return d.children || d._children ? "end" : "start";
                })
                .text(function (d) { return d.data.name; });

            var nodeUpdate = nodeEnter.merge(nodes);

            nodeUpdate.transition()
                .duration(duration)
                .attr("transform", function (d) {
                    return "translate(" + d.y + "," + d.x + ")";
                });

            nodeUpdate.select('circle')
                .attr('r', 10);

            nodeUpdate.select('text')
                .style("fill-opacity", 1);

            nodes.exit().transition()
                .duration(duration)
                .attr("transform", function (d) {
                    return "translate(" + source.y + "," + source.x + ")";
                })
                .remove();
        }
    </script>