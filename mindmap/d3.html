<!DOCTYPE html>
<meta charset="utf-8">
<style>
    body {
        width: 100vw;
        height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .node circle {
        fill: #fff;
        stroke: steelblue;
        stroke-width: 3px;
    }

    .node text {
        font-size: 22px;
        font-family: sans-serif;
    }

    .link {
        fill: none;
        stroke: green;
        stroke-width: 2px;
    }
</style>

<body>
    <script src="modules/d3.v5.min.js"></script>
    <script>
        var treeData = {
            "name": "图书管理系统功能",
            "children": [
                {
                    "name": "图书入库管理",
                    "children": [
                        {
                            "name": "图书信息录入"
                        },
                        {
                            "name": "标签打印"
                        },
                        {
                            "name": "入库登记"
                        }
                    ]
                },
                {
                    "name": "图书借阅管理",
                    "children": [
                        {
                            "name": "借阅登记"
                        },
                        {
                            "name": "借阅期限管理"
                        },
                        {
                            "name": "逾期提醒"
                        }
                    ]
                },
                {
                    "name": "图书归还管理",
                    "children": [
                        {
                            "name": "归还登记"
                        },
                        {
                            "name": "图书检查"
                        },
                        {
                            "name": "罚款计算"
                        }
                    ]
                },
                {
                    "name": "读者信息管理",
                    "children": [
                        {
                            "name": "个人档案"
                        },
                        {
                            "name": "借阅历史记录"
                        },
                        {
                            "name": "信用评分"
                        }
                    ]
                },
                {
                    "name": "图书检索系统",
                    "children": [
                        {
                            "name": "图书查询"
                        },
                        {
                            "name": "检索功能"
                        },
                        {
                            "name": "搜索结果展示功能"
                        }
                    ]
                },
                {
                    "name": "数据统计分析",
                    "children": [
                        {
                            "name": "数据统计"
                        },
                        {
                            "name": "数据分析"
                        },
                        {
                            "name": "报表和图表生成"
                        }
                    ]
                },
                {
                    "name": "图书馆资讯发布",
                    "children": [
                        {
                            "name": "最新资讯"
                        },
                        {
                            "name": "活动通知"
                        },
                        {
                            "name": "图书推荐"
                        }
                    ]
                },
                {
                    "name": "库存管理",
                    "children": [
                        {
                            "name": "库存监控"
                        },
                        {
                            "name": "报废处理"
                        },
                        {
                            "name": "库存调整"
                        }
                    ]
                },
                {
                    "name": "扩展阅读推荐",
                    "children": [
                        {
                            "name": "相关推荐"
                        },
                        {
                            "name": "阅读体验"
                        }
                    ]
                },
                {
                    "name": "在线预订系统",
                    "children": [
                        {
                            "name": "预订功能"
                        },
                        {
                            "name": "预订管理"
                        },
                        {
                            "name": "预订取消"
                        }
                    ]
                }
            ]
        }

        var margin = { top: 20, right: 240, bottom: 20, left: 240 },
            width = 1400 - margin.left - margin.right,
            height = 1000 - margin.top - margin.bottom;

        var svg = d3.select("body").append("svg")
            .attr("width", width + margin.right + margin.left)
            .attr("height", height + margin.top + margin.bottom)
            .append("g")
            .attr("transform", "translate("
                + margin.left + "," + margin.top + ")");

        var i = 0,
            duration = 750,
            root;

        root = d3.hierarchy(treeData, function (d) { return d.children; });
        root.x0 = height / 2;
        root.y0 = 0;

        update(root);

        function diagonal(s, d) {
            return `M ${s.y},${s.x} C ${(s.y + d.y) / 2},${s.x} ${(s.y + d.y) / 2},${d.x} ${d.y},${d.x}`;
        }

        function update(source) {
            var treeLayout = d3.tree().size([width, height]);
            var treeData = treeLayout(root);

            var links = svg.selectAll('path.link')
                .data(treeData.links(), function (d) { return d.target.id; });

            links.enter().append('path')
                .attr('class', 'link')
                .merge(links)
                .transition()
                .duration(duration)
                .attr('d', function (d) { return diagonal(d.source, d.target); });

            links.exit()
                .remove();

            var nodes = svg.selectAll('g.node')
                .data(treeData.descendants(), function (d) { return d.id || (d.id = ++i); });

            var nodeEnter = nodes.enter().append('g')
                .attr('class', 'node')
                .attr("transform", function (d) {
                    return "translate(" + source.y + "," + source.x + ")";
                });

            nodeEnter.append('circle')
                .attr('r', 1e-6);

            nodeEnter.append('text')
                .attr("dy", ".35em")
                .attr("x", function (d) {
                    return d.children || d._children ? -10 : 10;
                })
                .attr("text-anchor", function (d) {
                    return d.children || d._children ? "end" : "start";
                })
                .text(function (d) { return d.data.name; });

            var nodeUpdate = nodeEnter.merge(nodes);

            nodeUpdate.transition()
                .duration(duration)
                .attr("transform", function (d) {
                    return "translate(" + d.y + "," + d.x + ")";
                });

            nodeUpdate.select('circle')
                .attr('r', 10);

            nodeUpdate.select('text')
                .style("fill-opacity", 1);

            nodes.exit().transition()
                .duration(duration)
                .attr("transform", function (d) {
                    return "translate(" + source.y + "," + source.x + ")";
                })
                .remove();
        }
    </script>